language: go
type: application

fileGroups:
  sources:
    - 'bindings/**/*'
    - 'cmd/**/*'
    - 'core/**/*'
    - 'mocks/**/*'
    - 'types/**/*'
    - '*.go'
    - 'go.mod'
    - '/go.mod'
    - '/avs-eigensdk-go/**/*.go'
    - '/avs-eigensdk-go/**/go.mod'

tasks:
  # format:
  #   command: 'go fmt ./...'
  #   inputs: ['@globs(sources)']

  build:
    command: 'go build -o build/avs-aggregator cmd/main.go'
    inputs: ['@globs(sources)']
    outputs: ['build/avs-aggregator']
  
  build-image-local:
    command: 'docker buildx build -t gaspxyz/avs-aggregator:local -f Dockerfile ../'
    inputs: ['@globs(sources)', 'Dockerfile']

  build-ci:
    script: GOOS=linux GOARCH=amd64 go build -o build/avs-aggregator-linux-amd64 cmd/main.go
    inputs: ['@globs(sources)']
    outputs: ['build/avs-aggregator-linux-amd64']
  
  build-image-ci-not-rust:
    command: 'docker buildx build --platform linux/amd64 -t gaspxyz/avs-aggregator:${IMAGE_TAG} -f Dockerfile.ci . --load'
    deps: ['build-ci']